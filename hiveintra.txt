hiveintra

1ï¸âƒ£ Nombre total dâ€™achats rÃ©alisÃ©s

(Ã©quivalent Ã  : COUNT(*))

SELECT COUNT(*) AS total_achats FROM client;

2ï¸âƒ£ Chiffre dâ€™affaires total (quantitÃ© Ã— prix)
SELECT SUM(quantite * prix) AS total_revenue FROM client;

3ï¸âƒ£ Produit le plus cher
SELECT produit, MAX(prix) AS max_price
FROM client
GROUP BY produit
ORDER BY max_price DESC
LIMIT 1;

4ï¸âƒ£ QuantitÃ© moyenne achetÃ©e par transaction
SELECT AVG(quantite) AS avg_quantity FROM client;

5ï¸âƒ£ Les 5 clients qui ont achetÃ© le plus (en nombre de transactions)

(chez toi une ligne = une transaction)

SELECT nom, prenom, COUNT(*) AS total_transactions
FROM client
GROUP BY nom, prenom
ORDER BY total_transactions DESC
LIMIT 5;

6ï¸âƒ£ Chiffre dâ€™affaires total par produit
SELECT produit, SUM(quantite * prix) AS total_revenue
FROM client
GROUP BY produit
ORDER BY total_revenue DESC;

7ï¸âƒ£ Classement des produits les plus achetÃ©s (en quantitÃ© totale)
SELECT produit, SUM(quantite) AS total_qty
FROM client
GROUP BY produit
ORDER BY total_qty DESC;

8ï¸âƒ£ RÃ©partition des achats par genre (Masculin/Feminin)
SELECT genre, COUNT(*) AS total_achats,
       SUM(quantite * prix) AS total_revenue
FROM client
GROUP BY genre;

9ï¸âƒ£ Ã‚ge des clients + moyenne dâ€™Ã¢ge

ðŸ‘‰ Extraction dâ€™annÃ©e + calcul dâ€™Ã¢ge.
âš  Hive comprend from_unixtime + unix_timestamp

a) Liste des clients avec Ã¢ge :
SELECT nom, prenom, date_naissance,
       YEAR(CURRENT_DATE) - YEAR(TO_DATE(date_naissance)) AS age
FROM client;

b) Ã‚ge moyen :
SELECT AVG(YEAR(CURRENT_DATE) - YEAR(TO_DATE(date_naissance))) AS age_moyen
FROM client  

1ï¸âƒ£ Pourcentage des achats faits par les femmes
SELECT 
  (COUNT(CASE WHEN genre = 'Feminin' THEN 1 END) * 100.0 / COUNT(*)) 
  AS pct_femmes
FROM client;

2ï¸âƒ£ Pourcentage de ventes par produit (part de marchÃ© de chaque produit)
SELECT 
  produit,
  (SUM(quantite) * 100.0 / (SELECT SUM(quantite) FROM client)) AS pct_ventes
FROM client
GROUP BY produit;

3ï¸âƒ£ Produit le plus rentable (CA le plus Ã©levÃ©)
SELECT produit, SUM(quantite * prix) AS revenue
FROM client
GROUP BY produit
ORDER BY revenue DESC
LIMIT 1;

4ï¸âƒ£ Quel genre dÃ©pense le plus ? (H/F)
SELECT genre, SUM(quantite * prix) AS total_depense
FROM client
GROUP BY genre
ORDER BY total_depense DESC;

5ï¸âƒ£ Calculer le prix moyen par produit
SELECT produit, AVG(prix) AS avg_price
FROM client
GROUP BY produit;

6ï¸âƒ£ Ã‚ge moyen des clients
SELECT AVG(YEAR(CURRENT_DATE) - YEAR(TO_DATE(date_naissance))) AS age_moyen
FROM client;

7ï¸âƒ£ Classement des produits par volume vendu (quantitÃ© totale)
SELECT produit, SUM(quantite) AS qty_total
FROM client
GROUP BY produit
ORDER BY qty_total DESC;

8ï¸âƒ£ Classement des clients par montant total dÃ©pensÃ©
SELECT nom, prenom, SUM(quantite * prix) AS total_spent
FROM client
GROUP BY nom, prenom
ORDER BY total_spent DESC;

9ï¸âƒ£ Produit le moins vendu (en quantitÃ©)
SELECT produit, SUM(quantite) AS qty
FROM client
GROUP BY produit
ORDER BY qty ASC
LIMIT 1;

ðŸ”Ÿ Nombre de clients masculins vs fÃ©minins
SELECT genre, COUNT(*) AS total_clients
FROM client
GROUP BY genre;

1ï¸âƒ£1ï¸âƒ£ Pourcentage du chiffre dâ€™affaires du produit "Vehicule"
SELECT 
  (SUM(CASE WHEN produit = 'Vehicule' THEN quantite * prix END) * 100.0) 
  / SUM(quantite * prix) AS pct_vehicule
FROM client;

1ï¸âƒ£2ï¸âƒ£ Revenu moyen par client
SELECT AVG(total) AS avg_revenue_per_client
FROM (
    SELECT nom, prenom, SUM(quantite * prix) AS total
    FROM client
    GROUP BY nom, prenom
) t;

1ï¸âƒ£3ï¸âƒ£ Extraire lâ€™annÃ©e de naissance + compter les clients par annÃ©e
SELECT YEAR(TO_DATE(date_naissance)) AS year_birth,
       COUNT(*) AS total_clients
FROM client
GROUP BY YEAR(TO_DATE(date_naissance))
ORDER BY year_birth;

1ï¸âƒ£4ï¸âƒ£ Pourcentage de clients nÃ©s aprÃ¨s 1990
SELECT 
  (COUNT(CASE WHEN YEAR(TO_DATE(date_naissance)) > 1990 THEN 1 END) 
   * 100.0 / COUNT(*)) AS pct_after_1990
FROM client;